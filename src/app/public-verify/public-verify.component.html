<div class="container">
  <header class="header">
    <h1>Public Integrity Check</h1>
    <p>Verify cryptographic proof of Obrioxia immutable logs.</p>
  </header>

  <!-- Upload Zone -->
  <div 
    class="drop-zone" 
    [class.dragging]="isDragging()"
    (dragover)="onDragOver($event)" 
    (dragleave)="onDragLeave($event)" 
    (drop)="onDrop($event)">

    <!-- State: Idle (Waiting for File) -->
    <div class="content" *ngIf="!isProcessing() && !verificationResult()">
      <div class="icon">üì§</div>
      <h3>Drop JSON Log Export</h3>
      <label class="btn-upload">
        Select File
        <input type="file" (change)="onFileSelected($event)" accept=".json" hidden>
      </label>
    </div>

    <!-- State: Processing (Spinner) -->
    <div class="content processing" *ngIf="isProcessing()">
      <div class="spinner"></div>
      <p>Verifying Hash Chain...</p>
      <small>{{ fileName() }}</small>
    </div>

    <!-- State: Result (Success, Fail, or Empty) -->
    <div class="result-overlay" *ngIf="verificationResult()" [ngClass]="resultClass">
      
      <!-- Dynamic Icon -->
      <div class="result-icon">
        <span *ngIf="verificationResult()?.valid">‚úÖ</span>
        <span *ngIf="!verificationResult()?.valid && !verificationResult()?.isEmpty">‚ùå</span>
        <span *ngIf="verificationResult()?.isEmpty">‚ö†Ô∏è</span>
      </div>

      <!-- Dynamic Title -->
      <h2 *ngIf="verificationResult()?.valid">VERIFIED VALID</h2>
      <h2 *ngIf="!verificationResult()?.valid && !verificationResult()?.isEmpty">TAMPER DETECTED</h2>
      <h2 *ngIf="verificationResult()?.isEmpty">NO DATA FOUND</h2>

      <!-- Details -->
      <div class="details">
        <p>Entries Checked: <strong>{{ verificationResult()?.count }}</strong></p>
        
        <!-- Error Message with Dynamic Color -->
        <p *ngIf="verificationResult()?.error" class="error-msg" [style.color]="verificationResult()?.isEmpty ? '#ffc107' : '#ff6b6b'">
          {{ verificationResult()?.error }}
        </p>
      </div>

      <button class="btn-reset" (click)="verificationResult.set(null)">Verify Another</button>
    </div>
  </div>

  <!-- Chain Visualization (Only shows if data exists) -->
  <div class="chain-viz" *ngIf="chainData().length > 0">
    <h3>Live Chain Tail (Last 100 Blocks)</h3>
    <div class="chain-list">
      <div class="block" *ngFor="let block of chainData()">
        <span class="hash" [title]="block.entry_hash">{{ block.entry_hash | slice:0:8 }}...</span>
        <span class="time">{{ block.ts_iso | date:'mediumTime' }}</span>
      </div>
    </div>
  </div>
</div>
